{"version":3,"file":"react-use-audio-player.esm.js","sources":["../src/audioPlayerState.ts","../src/context.ts","../src/AudioPlayerProvider.tsx","../src/useAudioPlayer.ts","../src/useIsomorphicLayout.tsx","../src/useAudioPosition.ts"],"sourcesContent":["export enum Actions {\n    START_LOAD,\n    ON_LOAD,\n    ON_PLAY,\n    ON_END,\n    ON_PAUSE,\n    ON_STOP,\n    ON_PLAY_ERROR,\n    ON_LOAD_ERROR\n}\n\ninterface BaseAction {\n    type: Actions\n}\n\ninterface ErrorAction extends BaseAction {\n    error: Error\n}\n\ninterface LoadAction extends BaseAction {\n    duration: number\n}\n\ntype Action = BaseAction | ErrorAction | LoadAction\n\nexport interface AudioPlayerState {\n    loading: boolean\n    playing: boolean\n    stopped: boolean\n    error: Error | null\n    duration: number\n    ready: boolean\n    ended: boolean\n}\n\nexport const initialState: AudioPlayerState = {\n    loading: true,\n    playing: false,\n    stopped: true,\n    ended: false,\n    error: null,\n    duration: 0,\n    ready: false\n}\n\nexport function reducer(state: AudioPlayerState, action: Action) {\n    switch (action.type) {\n        case Actions.START_LOAD:\n            return {\n                ...state,\n                loading: true,\n                stopped: true,\n                ready: false,\n                error: null,\n                duration: 0\n            }\n        case Actions.ON_LOAD:\n            return {\n                ...state,\n                loading: false,\n                duration: (action as LoadAction).duration,\n                ended: false,\n                ready: true\n            }\n        case Actions.ON_PLAY:\n            return {\n                ...state,\n                playing: true,\n                ended: false,\n                stopped: false\n            }\n        case Actions.ON_STOP:\n            return {\n                ...state,\n                stopped: true,\n                playing: false\n            }\n        case Actions.ON_END:\n            return {\n                ...state,\n                stopped: true,\n                playing: false,\n                ended: true\n            }\n        case Actions.ON_PAUSE:\n            return {\n                ...state,\n                playing: false\n            }\n        case Actions.ON_PLAY_ERROR:\n            return {\n                ...state,\n                playing: false,\n                stopped: true,\n                error: (action as ErrorAction).error\n            }\n        case Actions.ON_LOAD_ERROR:\n            return {\n                ...state,\n                playing: false,\n                stopped: true,\n                loading: false,\n                error: (action as ErrorAction).error\n            }\n        default:\n            return state\n    }\n}\n","import React from \"react\"\nimport { AudioPlayerContext, AudioPlayerPositionContext } from \"./types\"\n\nexport const playerContext = React.createContext<AudioPlayerContext | null>(\n    null\n)\n\nexport const positionContext = React.createContext<AudioPlayerPositionContext>({\n    position: 0,\n    setPosition: () => {}\n})\n","import React, {\n    useState,\n    useCallback,\n    useEffect,\n    useRef,\n    useReducer,\n    useMemo\n} from \"react\"\nimport { Howl, HowlOptions } from \"howler\"\nimport { initialState, reducer, Actions } from \"./audioPlayerState\"\nimport { playerContext, positionContext } from \"./context\"\nimport { AudioPlayerContext } from \"./types\"\n\nexport interface AudioPlayerProviderProps {\n    children: React.ReactNode\n    value?: AudioPlayerContext\n}\n\nexport function AudioPlayerProvider({\n    children,\n    value\n}: AudioPlayerProviderProps) {\n    const [player, setPlayer] = useState<Howl | null>(null)\n    const [\n        { loading, error, playing, stopped, duration, ready, ended },\n        dispatch\n    ] = useReducer(reducer, initialState)\n\n    const playerRef = useRef<Howl>()\n    const prevPlayer = useRef<Howl>()\n\n    const [position, setPosition] = useState(0)\n    const positionContextValue = useMemo(\n        () => ({\n            position,\n            setPosition\n        }),\n        [position, setPosition]\n    )\n\n    const constructHowl = useCallback((audioProps: HowlOptions): Howl => {\n        return new Howl(audioProps)\n    }, [])\n\n    const load = useCallback(\n        ({ src, autoplay = false, html5 = false, ...rest }: HowlOptions) => {\n            let wasPlaying = false\n            if (playerRef.current) {\n                // don't do anything if we're asked to reload the same source\n                // @ts-ignore the _src argument actually exists\n                const { _src } = playerRef.current\n                // internal Howl _src property is sometimes an array and other times a single string\n                // still need to to do more research on why this is\n                const prevSrc = Array.isArray(_src) ? _src[0] : _src\n                if (prevSrc === src) return\n\n                // if the previous sound is still loading then destroy it as soon as it finishes\n                if (loading) {\n                    prevPlayer.current = playerRef.current\n                    prevPlayer.current.once(\"load\", () => {\n                        prevPlayer.current?.unload()\n                    })\n                } else {\n                    prevPlayer.current = playerRef.current\n                    prevPlayer.current?.unload()\n                }\n\n                wasPlaying = playerRef.current.playing()\n                if (wasPlaying) {\n                    playerRef.current.stop()\n                    // remove event handlers from player that is about to be replaced\n                    playerRef.current.off()\n                    playerRef.current = undefined\n                }\n            }\n\n            // signal that the loading process has begun\n            dispatch({ type: Actions.START_LOAD })\n\n            // create a new player\n            const howl = constructHowl({\n                src,\n                autoplay: wasPlaying || autoplay, // continues playing next song\n                html5,\n                ...rest\n            })\n\n            // if this howl has already been loaded (cached) then fire the load action\n            // @ts-ignore _state exists\n            if (howl._state === \"loaded\") {\n                dispatch({ type: Actions.ON_LOAD, duration: howl.duration() })\n            }\n\n            howl.on(\n                \"load\",\n                () =>\n                    void dispatch({\n                        type: Actions.ON_LOAD,\n                        duration: howl.duration()\n                    })\n            )\n            howl.on(\"play\", () => void dispatch({ type: Actions.ON_PLAY }))\n            howl.on(\"end\", () => void dispatch({ type: Actions.ON_END }))\n            howl.on(\"pause\", () => void dispatch({ type: Actions.ON_PAUSE }))\n            howl.on(\"stop\", () => void dispatch({ type: Actions.ON_STOP }))\n            howl.on(\"playerror\", (_id, error) => {\n                dispatch({\n                    type: Actions.ON_PLAY_ERROR,\n                    error: new Error(\"[Play error] \" + error)\n                })\n            })\n            howl.on(\"loaderror\", (_id, error) => {\n                dispatch({\n                    type: Actions.ON_LOAD_ERROR,\n                    error: new Error(\"[Load error] \" + error)\n                })\n            })\n\n            setPlayer(howl)\n            playerRef.current = howl\n        },\n        [constructHowl, loading]\n    )\n\n    useEffect(() => {\n        // unload the player on unmount\n        return () => {\n            if (playerRef.current) playerRef.current.unload()\n        }\n    }, [])\n\n    const contextValue: AudioPlayerContext = useMemo(() => {\n        return value\n            ? value\n            : {\n                  player,\n                  load,\n                  error,\n                  loading,\n                  playing,\n                  stopped,\n                  ready,\n                  duration,\n                  ended\n              }\n    }, [\n        loading,\n        error,\n        playing,\n        stopped,\n        load,\n        value,\n        player,\n        ready,\n        duration,\n        ended\n    ])\n\n    return (\n        <playerContext.Provider value={contextValue}>\n            <positionContext.Provider value={positionContextValue}>\n                {children}\n            </positionContext.Provider>\n        </playerContext.Provider>\n    )\n}\n","import { useCallback, useContext, useEffect, useMemo } from \"react\"\nimport { Howl, HowlOptions } from \"howler\"\nimport { playerContext } from \"./context\"\nimport { AudioPlayerContext } from \"./types\"\n\nconst noop = () => {}\n\nexport type AudioPlayerControls = AudioPlayerContext & {\n    play: Howl[\"play\"] | typeof noop\n    pause: Howl[\"pause\"] | typeof noop\n    stop: Howl[\"stop\"] | typeof noop\n    mute: Howl[\"mute\"] | typeof noop\n    volume: Howl[\"volume\"] | typeof noop\n    fade: Howl[\"fade\"] | typeof noop\n    togglePlayPause: () => void\n}\n\nexport const useAudioPlayer = (options?: HowlOptions): AudioPlayerControls => {\n    const { player, load, ...rest } = useContext(playerContext)!\n\n    useEffect(() => {\n        const { src, ...restOptions } = options || {}\n        // if useAudioPlayer is called without arguments\n        // don't do anything: the user will have access\n        // to the current context\n        if (!src) return\n        // todo: could improve perf even more by not calling load if the options haven't really changed across renders of the calling component\n        load({ src, ...restOptions })\n    }, [options, load])\n\n    const togglePlayPause = useCallback(() => {\n        if (!player) return\n\n        if (player.playing()) {\n            player.pause()\n        } else {\n            player.play()\n        }\n    }, [player])\n\n    const boundHowlerMethods = useMemo(() => {\n        return {\n            play: player ? player.play.bind(player) : noop,\n            pause: player ? player.pause.bind(player) : noop,\n            stop: player ? player.stop.bind(player) : noop,\n            mute: player ? player.mute.bind(player) : noop,\n            volume: player ? player.volume.bind(player) : noop,\n            fade: player ? player.fade.bind(player) : noop\n        }\n    }, [player])\n\n    return useMemo(() => {\n        return {\n            ...rest,\n            ...boundHowlerMethods,\n            player,\n            load,\n            togglePlayPause\n        }\n    }, [rest, player, boundHowlerMethods, load, togglePlayPause])\n}\n","import { useEffect, useLayoutEffect } from \"react\"\n\n/**\n * Abstraction for useLayoutEffect.\n *\n * It will use useLayoutEffect() on the client, but while rendering on the server it will use\n * useEffect() to avoid ssr servers warnings like \"useLayoutEffect does nothing on the server\".\n */\nconst useIsomorphicLayoutEffect =\n    typeof window !== \"undefined\" ? useLayoutEffect : useEffect\n\nexport default useIsomorphicLayoutEffect\n","import { useCallback, useContext, useEffect, useMemo, useRef } from \"react\"\nimport { playerContext, positionContext } from \"./context\"\nimport { Howl } from \"howler\"\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayout\"\n\ninterface UseAudioPositionConfig {\n    highRefreshRate?: boolean\n}\n\ninterface AudioPosition {\n    position: number\n    duration: number\n    percentComplete: number\n    seek: (position: number) => number\n    speed: (rate: number | undefined) => number | undefined\n}\n\n// gives current audio position state - updates in an animation frame loop for animating audio visualizations\nexport const useAudioPosition = (\n    config: UseAudioPositionConfig = {}\n): AudioPosition => {\n    const { highRefreshRate = false } = config\n    const { player, playing, stopped, duration } = useContext(playerContext)!\n    const { position, setPosition } = useContext(positionContext)\n\n    const animationFrameRef = useRef<number>()\n\n    // sets position on player initialization and when the audio is stopped\n    useEffect(() => {\n        if (player) {\n            setPosition(player.seek() as number)\n        }\n    }, [player, setPosition, stopped])\n\n    // updates position on a one second loop for low refresh rate default setting\n    useEffect(() => {\n        let timeout: number\n        if (!highRefreshRate && player && playing)\n            timeout = window.setInterval(\n                () => setPosition(player.seek() as number),\n                1000\n            )\n        return () => clearTimeout(timeout)\n    }, [highRefreshRate, player, playing, setPosition])\n\n    // updates position on a 60fps loop for high refresh rate setting\n    useIsomorphicLayoutEffect(() => {\n        const animate = () => {\n            setPosition(player?.seek() as number)\n            animationFrameRef.current = requestAnimationFrame(animate)\n        }\n\n        // kick off a new animation cycle when the player is defined and starts playing\n        if (highRefreshRate && player && playing) {\n            animationFrameRef.current = requestAnimationFrame(animate)\n        }\n\n        return () => {\n            if (animationFrameRef.current) {\n                cancelAnimationFrame(animationFrameRef.current)\n            }\n        }\n    }, [highRefreshRate, player, playing, setPosition])\n\n    const seek = useCallback(\n        position => {\n            if (!player) return 0\n\n            // it appears that howler returns the Howl object when seek is given a position\n            // to get the latest potion you must call seek again with no parameters\n            const result = player.seek(position) as Howl\n            const updatedPos = result.seek() as number\n            setPosition(updatedPos)\n            return updatedPos\n        },\n        [player, setPosition]\n    )\n\n    const speed = useCallback(\n        // This should update the playback speed if the rate is provided\n        // It returns the current playback speed\n        (rate: number | undefined) => {\n            if (rate) player?.rate(rate)\n            return player?.rate()\n        },\n        [player]\n    )\n\n    const percentComplete = useMemo(() => {\n        return (position / duration) * 100 || 0\n    }, [duration, position])\n\n    return { position, duration, seek, percentComplete, speed }\n}\n"],"names":["Actions","initialState","loading","playing","stopped","ended","error","duration","ready","reducer","state","action","type","START_LOAD","ON_LOAD","ON_PLAY","ON_STOP","ON_END","ON_PAUSE","ON_PLAY_ERROR","ON_LOAD_ERROR","playerContext","React","createContext","positionContext","position","setPosition","AudioPlayerProvider","children","value","useState","player","setPlayer","useReducer","dispatch","playerRef","useRef","prevPlayer","positionContextValue","useMemo","constructHowl","useCallback","audioProps","Howl","load","src","autoplay","html5","rest","wasPlaying","current","_src","prevSrc","Array","isArray","once","unload","stop","off","undefined","howl","_state","on","_id","Error","useEffect","contextValue","Provider","noop","useAudioPlayer","options","useContext","restOptions","togglePlayPause","pause","play","boundHowlerMethods","bind","mute","volume","fade","useIsomorphicLayoutEffect","window","useLayoutEffect","useAudioPosition","config","highRefreshRate","animationFrameRef","seek","timeout","setInterval","clearTimeout","animate","requestAnimationFrame","cancelAnimationFrame","result","updatedPos","speed","rate","percentComplete"],"mappings":"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"}